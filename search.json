---
layout: none
---
{
  "posts": [
    {% for post in site.posts %}
      {
        "title": {{ post.title | jsonify }},
        "category": {{ post.category | jsonify }},
        "tags": {{ post.tags | jsonify }},
        "url": {{ post.url | prepend: site.baseurl | jsonify }},
        "date": {{ post.date | date: '%B %-d, %Y' | jsonify }},
        "content": {{ post.content | strip_html | strip_newlines | jsonify }}
      }{% unless forloop.last %},{% endunless %}
    {% endfor %}
  ]
}

# Create js/search.js
(function() {
  function displaySearchResults(results, store) {
    const searchResults = document.getElementById('search-results');
    
    if (results.length) {
      let resultList = '';
      for (const n in results) {
        const item = store[results[n].ref];
        resultList += '<li><h3><a href="' + item.url + '">' + item.title + '</a></h3>';
        resultList += '<p>' + item.content.substring(0, 150) + '...</p></li>';
      }
      searchResults.innerHTML = resultList;
    } else {
      searchResults.innerHTML = '<li>No results found</li>';
    }
  }

  function getQueryVariable(variable) {
    const query = window.location.search.substring(1);
    const vars = query.split('&');

    for (const i in vars) {
      const pair = vars[i].split('=');
      if (pair[0] === variable) {
        return decodeURIComponent(pair[1].replace(/\+/g, '%20'));
      }
    }
  }

  const searchTerm = getQueryVariable('query');

  if (searchTerm) {
    document.getElementById('search-box').setAttribute("value", searchTerm);

    const idx = lunr(function () {
      this.field('id');
      this.field('title', { boost: 10 });
      this.field('category');
      this.field('content');
      this.field('tags');
    });

    fetch('/search.json')
      .then(response => response.json())
      .then(data => {
        const store = {};
        
        data.posts.forEach(function(post, index) {
          store[index] = {
            'title': post.title,
            'content': post.content,
            'url': post.url
          };
          
          idx.add({
            'id': index,
            'title': post.title,
            'content': post.content,
            'tags': post.tags,
            'category': post.category
          });
        });
        
        const results = idx.search(searchTerm);
        displaySearchResults(results, store);
      });
  }
})();

# Add to _includes/head.html
<script src="https://cdnjs.cloudflare.com/ajax/libs/lunr.js/2.3.9/lunr.min.js"></script>
<script src="/js/search.js"></script>